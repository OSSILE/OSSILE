#!/QOpenSys/usr/bin/sh
export PWD=$(pwd)

TARGET_LIB=OSSILE

if [ -e /QSYS.LIB/$TARGET_LIB.LIB/MESSAGE.FILE ] ; then
  system -kpieb "DLTOBJ OBJ($TARGET_LIB/MESSAGE) OBJTYPE(*FILE)"
fi
system -kpieb "CRTSRCPF FILE($TARGET_LIB/MESSAGE) RCDLEN(112)"
system -kpieb "CPYFRMSTMF FROMSTMF('$PWD/message.bnd') TOMBR('/QSYS.LIB/$TARGET_LIB.LIB/MESSAGE.FILE/MESSAGE.MBR') MBROPT(*REPLACE)"

if [ -e /QSYS.LIB/$TARGET_LIB.LIB/MESSAGE.MODULE ] ; then
  system -kpieb "DLTOBJ OBJ($TARGET_LIB/MESSAGE) OBJTYPE(*MODULE)"
fi
system -kpieb "CRTRPGMOD $TARGET_LIB/MESSAGE SRCSTMF('message.rpgle') OPTION(*SRCSTMT) DBGVIEW(*LIST) OPTIMIZE(*BASIC) STGMDL(*INHERIT)"

if [ -e /QSYS.LIB/$TARGET_LIB.LIB/MESSAGE.SRVPGM ] ; then
  system -kpieb "DLTOBJ OBJ($TARGET_LIB/MESSAGE) OBJTYPE(*SRVPGM)"
fi
system -kpieb "CRTSRVPGM $TARGET_LIB/MESSAGE MODULE($TARGET_LIB/MESSAGE) STGMDL(*INHERIT) EXPORT(*SRCFILE) SRCFILE($TARGET_LIB/MESSAGE) TEXT('Messages')"

# cleanup
system -kpieb "DLTOBJ OBJ($TARGET_LIB/MESSAGE) OBJTYPE(*FILE)"
system -kpieb "DLTOBJ OBJ($TARGET_LIB/MESSAGE) OBJTYPE(*MODULE)"

if [ ! -e /QSYS.LIB/$TARGET_LIB.LIB/MESSAGE.SRVPGM ] ; then
  exit 5
fi

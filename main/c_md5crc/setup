#!/QOpenSys/usr/bin/sh
export PWD=$(pwd)
system -kpieb "CRTCMOD MODULE(OSSILE/BACKUP) SRCSTMF('$PWD/backup.c') REPLACE(*YES)"
exec system -kpieb "CRTPGM PGM(OSSILE/BACKUP) MODULE(OSSILE/BACKUP)"

system -kpieb "CRTSRCPF FILE(OSSILE/QUIMSRC) RCDLEN(150)"
system -kpieb "CRTSRCPF FILE(OSSILE/QDDSSRC) RCDLEN(150)"
system -kpieb "CRTSRCPF FILE(OSSILE/H) RCDLEN(150)"
system -kpieb "CRTSRCPF FILE(OSSILE/QCSRC) RCDLEN(150)"
# Create the Binding directory, delete first and then add the module   
exec system -kpieb "DLTBNDDIR BNDDIR(OSSILE/MD5)"
exec system -kpieb "CRTBNDDIR BNDDIR(OSSILE/MD5)"
exec system -kpieb "ADDBNDDIRE BNDDIR(OSSILE/MD5) OBJ((OSSILE/MD5FUNC *MODULE))"    
# Create the QDDSSRC Source member and copy the md5dets file source
system -kpieb "ADDPFM FILE(OSSILE/QDDSSRC) MBR(MD5DETS) SRCTYPE(PF)"
system -kpieb "CPYFRMSTMF FROMSTMF($PWD/qddssrc/md5dets.pf) TOMBR('/QSYS.LIB/OSSILE.LIB/QDDSSRC.FILE/MD5DETS.MBR) MBROPT(*REPLACE)"  
exec system -kpieb "CRTPF FILE(OSSILE/MD5DETS) SRCFILE(OSSILE/QDDSSRC) TEXT(*NONE) SIZE(*NOMAX) REUSEDLT(*YES)"   
# C Header files
system -kpieb "ADDPFM FILE(OSSILE/H) MBR(MD5) SRCTYPE(C)"
system -kpieb "CPYFRMSTMF FROMSTMF($PWD/h/md5.h) TOMBR('/QSYS.LIB/OSSILE.LIB/H.FILE/MD5.MBR) MBROPT(*REPLACE)"
system -kpieb "ADDPFM FILE(OSSILE/H) MBR(MD5FUNC) SRCTYPE(C)"
system -kpieb "CPYFRMSTMF FROMSTMF($PWD/h/md5func.h) TOMBR('/QSYS.LIB/OSSILE.LIB/H.FILE/MD5FUNC.MBR) MBROPT(*REPLACE)"
# C Source files
system -kpieb "ADDPFM FILE(OSSILE/QCSRC) MBR(CRTMD5) SRCTYPE(C)"
system -kpieb "CPYFRMSTMF FROMSTMF($PWD/qcsrc/crtmd5.c) TOMBR('/QSYS.LIB/OSSILE.LIB/QCSRC.FILE/CRTMD5.MBR) MBROPT(*REPLACE)"
system -kpieb "ADDPFM FILE(OSSILE/QCSRC) MBR(MD5FUNC) SRCTYPE(C)"
system -kpieb "CPYFRMSTMF FROMSTMF($PWD/qcsrc/md5func.h) TOMBR('/QSYS.LIB/OSSILE.LIB/QCSRC.FILE/MD5FUNC.MBR) MBROPT(*REPLACE)"    
# Create the C Programs
exec system -kpieb "CRTCMOD MODULE(OSSILE/CRTMD5) SRCFILE(OSSILE/QCSRC) TEXT(*NONE) OUTPUT(*PRINT)"
exec system -kpieb "CRTCMOD MODULE(OSSILE/MD5FUNC) SRCFILE(OSSILE/QCSRC) TEXT(*NONE) OUTPUT(*PRINT)"
exec system -kpieb "CRTPGM PGM(OSSILE/CRTMD5) MODULE(OSSILE/CRTMD5) TEXT('') BNDDIR(OSSILE/MD5)"   
# UIM Source
system -kpieb "ADDPFM FILE(OSSILE/QUIMSRC) MBR(CMDHLP) SRCTYPE(PNLGRP)"
system -kpieb "CPYFRMSTMF FROMSTMF($PWD/quimsrc/cmdhlp.pnlgrp) TOMBR('/QSYS.LIB/OSSILE.LIB/QUIMSRC.FILE/CMDHLP.MBR) MBROPT(*REPLACE)"    
# Create the panel group
exec system -kpieb "CRTPNLGRP PNLGRP(&INSTLIB/CMDHLP) SRCFILE(&SRCLIB/QUIMSRC)"
# Copy the command source
system -kpieb "ADDPFM FILE(OSSILE/QCMDSRC) MBR(CRTMD5) SRCTYPE(CMD)"
system -kpieb "CPYFRMSTMF FROMSTMF($PWD/qcmdsrc/crtmd5.cmd) TOMBR('/QSYS.LIB/OSSILE.LIB/QCMDSRC.FILE/CRTMD5.MBR) MBROPT(*REPLACE)"
# create the command
exec system -kpieb "CRTCMD CMD(OSSILE/CRTMD5) PGM(CRTMD5) SRCFILE(OSSILE/QCMDSRC)"
# Clean up the source files and binding directory
system -kpieb "DLTF FILE(&INTOLIB/H)"
system -kpieb "DLTF FILE(&INTOLIB/QCSRC)"
system -kpieb "DLTF FILE(&INTOLIB/QCMDSRC)"
system -kpieb "DLTF FILE(&INTOLIB/QUIMSRC)"
system -kpieb "DLTF FILE(&INTOLIB/QDDSSRC)"
system -kpieb "DLTBNDDIR BNDDIR(&INTOLIB/MD5)" 